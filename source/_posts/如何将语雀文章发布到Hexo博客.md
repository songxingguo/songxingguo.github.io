---
title: å¦‚ä½•å°†è¯­é›€æ–‡ç« å‘å¸ƒåˆ°Hexoåšå®¢
urlname: gwpsg4dq6tp27z3s
date: '2023-02-07 05:15:12 +0000'
tags: []
categories: []
---

## å†™åœ¨å‰é¢

å®ç°è¯­é›€ä¸Šçš„æ–‡ç« è‡ªåŠ¨åŒ–å‘å¸ƒåˆ°ä¸ªäººåšå®¢ï¼Œé¦–å…ˆæ˜¯å› ä¸ºè¯­é›€æœ¬èº«æ˜¯ä¸€ä¸ªä¼˜ç§€çš„åˆ›ä½œçš„å¹³å°ï¼Œèƒ½æ–¹ä¾¿çš„ç¼–è¾‘å’Œç®¡ç†æ–‡ç« ï¼Œä½†ç¼ºç‚¹æ˜¯å®ƒæœ¬èº«æ˜¯ä¸€ä¸ªå°é—­çš„ç³»ç»Ÿï¼Œå°±åƒå¾®ä¿¡å…¬ä¼—å·ä¸€æ ·ï¼Œä¸åˆ©äº SEOã€‚å…¶æ¬¡ä¸ªäººåšå®¢æ˜¯ç”±è‡ªå·±æ­å»ºï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œä¹Ÿèƒ½æ›´å¥½çš„è¿›è¡Œ SEOã€‚åŸºäºè¿™ä¸¤ç‚¹åŸå› ï¼Œè¯­é›€+ä¸ªäººåšå®¢å°±æ˜¯ä¸€ä¸ªå®Œç¾çš„ç»„åˆï¼Œä¸ªäººåšå®¢ä½œä¸ºå‰å°ï¼Œè¯­é›€ä½œä¸ºåå°ï¼Œæ—¢èƒ½èƒ½å¾ˆå¥½çš„åˆ›é€ å’Œç®¡ç†æ–‡ç« ï¼Œæœ‰èƒ½å¤Ÿå°†éœ€è¦å…±äº«çš„æ–‡ç« å‘å¸ƒåˆ°ä¸ªäººåšå®¢ï¼Œä¾›å¤§å®¶æœç´¢ã€‚ä¸‹é¢è¦åšçš„å°±æ˜¯å»ºç«‹èµ·ä¸¤è€…çš„æ¡¥æ¢ã€‚

## ä¼ é€é—¨

- [é¡¹ç›®åœ°å€](https://github.com/songxingguo/songxingguo.github.io)
- ä½¿ç”¨æ•ˆæœï¼ˆè§†é¢‘ï¼‰

## è®¾è®¡æ€è·¯

![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/Fv4SHStOd0NQNbe-P78SUpwLcqdJ.jpeg)
æ•´ä½“çš„è®¾è®¡æ€è·¯æ˜¯æ¯æ¬¡è¯­é›€æ›´æ–°æ–‡æ¡£éƒ½é€šè¿‡ Webhook å‘é€é’‰é’‰æ¶ˆæ¯ï¼Œå½“æ‰‹åŠ¨ç‚¹å‡»ã€å‘å¸ƒã€‘çš„æ—¶å€™å†è§¦å‘ GithubAction å°† slug å¯¹åº”çš„æ–‡ç« ä»è¯­é›€æ‹‰å–ä¸‹å»å¹¶æ¨é€åˆ°åšå®¢ä»“åº“ï¼Œæœ€åéƒ¨ç½²åšå®¢ã€‚è§¦å‘æµç¨‹è™½ç„¶æ˜¯ä»è¯­é›€åˆ° Github çš„è¿‡ç¨‹ï¼Œä½†å¼€å‘çš„è¿‡ç¨‹æ˜¯ä¼˜å…ˆå¤„ç† Github éƒ¨åˆ†ç„¶åå†ç”±è¯­é›€è§¦å‘ Webhookï¼Œå¼€å‘è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ã€‚

1. é…ç½®`yuque-heox-publish`
2. é…ç½®`.github/workflows/publish.yml`
3. ä½¿ç”¨äº‘å‡½æ•°è§¦å‘ GithubAction
4. ä½¿ç”¨äº‘å‡½æ•°æ¨é€é’‰é’‰æ¶ˆæ¯
5. é…ç½®è¯­é›€ Webhook

<!-- more -->

### `yuque-hexo-publish`æ˜¯ä»€ä¹ˆ

`[yuque-hexo](https://github.com/x-cold/yuque-hexo)`æ˜¯ä¸€ä¸ªå¾ˆä¼˜ç§€çš„æ’ä»¶ï¼Œèƒ½å°†è¯­é›€çš„æ–‡ç« å®Œå…¨**åŒæ­¥**åˆ°ä¸ªäººåšå®¢ä¸Šã€‚ä½†è¿™å¹¶ä¸æ»¡è¶³æˆ‘çš„éœ€æ±‚ï¼Œæˆ‘éœ€è¦çš„æ˜¯å‘å¸ƒè€Œä¸æ˜¯åŒæ­¥ï¼Œæˆ‘å¹¶ä¸æƒ³æŠŠæ‰€æœ‰æ–‡ç« éƒ½**åŒæ­¥**åˆ°ä¸ªäººåšå®¢ä¸Šï¼Œä¹Ÿä¸å¸Œæœ›åªèƒ½æœ‰ä¸€ä¸ªçŸ¥è¯†åº“é‡Œé¢çš„æ–‡ç« èƒ½**å‘å¸ƒ**åˆ°ä¸ªäººåšå®¢ï¼Œè€Œæ˜¯å¸Œæœ›èƒ½æŠŠæˆ‘æƒ³å‘å¸ƒçš„æ–‡ç« éƒ½èƒ½**å‘å¸ƒ**åˆ°ä¸ªäººåšå®¢ä¸Šã€‚åŸºäºè¿™ä¸ªè¿™ä¸ªè€ƒè™‘æˆ‘åœ¨`yuque-hexo`çš„åŸºç¡€ä¸Šæ–°å¢äº†å‘å¸ƒåŠŸèƒ½ï¼Œ`yuque-hexo-publish`å°±æ­¤è¯ç”Ÿäº†ã€‚yuque-hexo-publish åœ¨åŠŸèƒ½ä¸Šå’Œ yuque-hexo æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œåªæ˜¯æ–°å¢äº†å‘½ä»¤ publishã€‚

## å…·ä½“å®æ–½

### Hexo åšå®¢å¼€å‘

#### é¡¹ç›®é…ç½®

1. `package.json`ä¸­é…ç½® yuque-hexo-publishã€‚

```yaml
  "yuqueConfig": {
    "postPath": "source/_posts", //æ–‡ç« ç›®å½•
    "baseUrl": "https://www.yuque.com/api/v2",
    "login": "songxingguo",//ç”¨æˆ·å
    "repo": "devhints", //çŸ¥è¯†åº“åç§°
    "onlyPublished": false,
    "onlyPublic": false,
    "imgCdn": {
      "concurrency": 1,
      "imageBed": "github", //å›¾åºŠç±»å‹
      "enabled": true,
      "bucket": "songxingguo.github.io", //ä»“åº“åœ°å€
      "prefixKey": "static/images" //å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ åˆ°ä»“åº“åçš„ç›®å½•
    }
  }
```

æ›´è¯¦ç»†çš„é…ç½®è¯´æ˜å¯ä»¥æŸ¥çœ‹`[yuque-hexo-publish](https://github.com/songxingguo/yuque-hexo/tree/feature-publish)`ã€‚

2. `package.json`ä¸­æ·»åŠ ä»»åŠ¡è„šæœ¬ã€‚

```bash
  "scripts": {
    "build": "hexo generate",
    "pulish": "yuque-hexo publish",
  },
```

3. æ ¹ç›®å½•ä¸‹æ–°å»º` .github/workflows/publish.yml`ã€‚

```yaml
name: Deploy To Github Pages
on: [repository_dispatch]
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      - name: Setup Node.js
        uses: actions/setup-node@master
        with:
          node-version: "12.0.0"

      - name: Install and Build ğŸ”§
        env:
          YUQUE_TOKEN: ${{ secrets.YUQUE_TOKEN }}
          SLUG: ${{ github.event.client_payload.slug }}
          SECRET_ID: songxingguo
          SECRET_KEY: ${{ secrets.ACCESS_TOKEN }}
        run: |
          npm i
          npm run publish
          npm run build

      - name: é…ç½®Gitç”¨æˆ·åé‚®ç®±
        run: |
          git config --global user.name "songxingguo"
          git config --global user.email "1328989942@qq.com"

      - name: æäº¤yuqueæ‹‰å–çš„æ–‡ç« åˆ°GitHubä»“åº“
        run: |
          git pull
          git add .
          git commit -m "feat:æäº¤æ–‡ç« " -a

      - name: æ¨é€æ–‡ç« åˆ°ä»“åº“
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.ACCESS_TOKEN }}

      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          BRANCH: master
          FOLDER: public
          CLEAN: true
```

`YUQUE_TOKE`å’Œ`ACCESS_TOKEN`éƒ½æ˜¯ Github çš„ç¯å¢ƒå˜é‡ï¼Œ`github.event.client_payload.slug`æ˜¯`[repository_dispatch](https://docs.github.com/zh/actions/using-workflows/events-that-trigger-workflows#repository_dispatch)`äº‹ä»¶ä¸­ä¼ é€’çš„å‚æ•°ã€‚

#### å¦‚ä½•æœ¬åœ°è°ƒè¯•

```bash
YUQUE_TOKEN=xxx SLUG=xxx yuque-hexo publish
```

`yuque-hexo publish `éœ€è¦ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œ`YUQUE_TOKEN`æ˜¯è¯­é›€çš„[æˆæƒç ](https://www.yuque.com/settings/tokens)ï¼Œ`SLUG`æ˜¯è¯­é›€æ–‡ç« çš„ idã€‚

### é˜¿é‡Œäº‘å‡½æ•°å¼€å‘

#### åˆå§‹åŒ–äº‘å‡½æ•°

1. åˆ›å»ºä¸€ä¸ªå¤„ç† http è¯·æ±‚çš„ node.js äº‘å‡½æ•°ï¼Œ[äº‘å‡½æ•°åˆ›å»ºåœ°å€](https://fcnext.console.aliyun.com/cn-hangzhou/tasks)ã€‚

![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/FmgXhivkd1GDSXivmeXk4GFgJ5mW.png)

2. åˆ›å»ºå¥½åçš„æ•ˆæœå¦‚ä¸‹ã€‚

![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/Fn9FBWVuiHojlCDdNBudsnalwEXs.png)

#### è°ƒè¯•äº‘å‡½æ•°

1. é…ç½®æµ‹è¯•è¯·æ±‚ã€‚

![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/FrNF5Qqv5Z8c-GdIRsTEUU9fR6Rq.png)

2. éƒ¨ç½²ä»£ç ä¹‹åï¼Œç‚¹å‡»ã€æµ‹è¯•å‡½æ•°ã€‘ï¼Œå°±å¯ä»¥çœ‹åˆ°æ—¥å¿—è¾“å‡ºã€‚

![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/Fm13C_KkS6MOfXCgdToHQqHVS7-p.png)

#### ä½¿ç”¨äº‘å‡½æ•°è§¦å‘ GithubAction

è¿™ä¸ªå‡½æ•°æ˜¯é€šè¿‡ Get è¯·æ±‚è¿›è¡Œè°ƒç”¨çš„ã€‚

```javascript
https://xx-xx-opbwmocbhe.cn-hangzhou.fcapp.run?slug=${slug}`
```

é¦–å…ˆéœ€è¦ä»å‚æ•°ä¸­è·å– slugã€‚

```javascript
const slug = params.queries.slug;
```

ç„¶åä½¿ç”¨`[repository_dispatch](https://docs.github.com/zh/actions/using-workflows/events-that-trigger-workflows#repository_dispatch)`äº‹ä»¶è§¦å‘ GithubActionï¼Œå¹¶å°†`slug`ä¼ ç»™`client_payload`ã€‚

```javascript
const axios = require("axios");

const options = {
  method: "POST",
  url: "https://api.github.com/repos/songxingguo/songxingguo.github.io/dispatches",
  headers: {
    "content-type": "application/json",
    Accept: "application/vnd.github+json",
    Authorization: "Bearer GITHUB_TOKEN",
  },
  data: { event_type: "publish", client_payload: { slug } },
};

axios
  .request(options)
  .then(function (response) {
    console.log(response.data);
  })
  .catch(function (error) {
    console.error(error);
  });
```

å…¶ä¸­`GITHUB_TOKEN`æ˜¯ github çš„æˆæƒç ï¼Œè·å–å’Œé…ç½®å¯ä»¥å‚è€ƒ[ä½¿ç”¨ Github Action éƒ¨ç½²é™æ€ç½‘ç«™](https://www.yuque.com/songxingguo/devhints/tfub27hk86lsdrpb)ã€‚`event_type`æ˜¯æ´»åŠ¨ç±»å‹è¿™ä¸ªå’Œ`.github/workflows/publish.yml`é‡Œé¢çš„`types`æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå¦‚æœ`.github/workflows/publish.yml`ä¸­æ²¡æœ‰æŒ‡å®šå…·ä½“`types`ï¼Œé‚£è¿™å„¿å¡«ä»»ä½•å€¼éƒ½æ˜¯å¯ä»¥ã€‚å…·ä½“ä¿¡æ¯å¯ä»¥æŸ¥çœ‹[è¯¦ç»†é…ç½®](https://docs.github.com/zh/developers/webhooks-and-events/webhooks/webhook-events-and-payloads#repository_dispatch)ã€‚
![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/FveEzFT5TggObDiemqVIn5zlRzAd.png)
å®Œæ•´ä»£ç å¦‚ä¸‹ã€‚

> éœ€è¦æ³¨æ„ âš ï¸ å¼‚æ­¥æ‰§è¡Œçš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡`async-await`ä¿è¯è¯·æ±‚æ˜¯åœ¨`resp.send`ä¹‹å‰æ‰§è¡Œçš„ã€‚

```javascript
var axios = require("axios");
var getRawBody = require("raw-body");
var getFormBody = require("body/form");
var body = require("body");

/*
To enable the initializer feature (https://help.aliyun.com/document_detail/156876.html)
please implement the initializer function as belowï¼š
exports.initializer = (context, callback) => {
  console.log('initializing');
  callback(null, '');
};
*/

exports.handler = (req, resp, context) => {
  var params = {
    path: req.path,
    queries: req.queries,
    headers: req.headers,
    method: req.method,
    requestURI: req.url,
    clientIP: req.clientIP,
  };

  getRawBody(req, async (err, body) => {
    for (var key in req.queries) {
      var value = req.queries[key];
      resp.setHeader(key, value);
    }
    resp.setHeader("Content-Type", "text/plain");
    params.body = body.toString();
    const slug = params.queries.slug;
    console.log("slug", slug);

    const options = {
      method: "POST",
      url: "https://api.github.com/repos/songxingguo/songxingguo.github.io/dispatches",
      headers: {
        "content-type": "application/json",
        Accept: "application/vnd.github+json",
        Authorization: "Bearer xxx",
      },
      data: { event_type: "publish", client_payload: { slug } },
    };

    await axios
      .request(options)
      .then(function (response) {
        console.log(response.data);
      })
      .catch(function (error) {
        console.error(error);
      });

    resp.send(JSON.stringify(params, null, "    "));
  });
};
```

#### ä½¿ç”¨äº‘å‡½æ•°æ¨é€é’‰é’‰æ¶ˆæ¯

##### è°ƒè¯•é’‰é’‰æ¶ˆæ¯ç±»å‹åŠæ•°æ®æ ¼å¼

1. åˆ›å»ºé’‰é’‰æœºå™¨äººï¼Œå¹¶å¤åˆ¶ webhook åœ°å€ã€‚

![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/FhiBRGA1W_Z4-GzqzjiH5esIggKG.png)

2. æ‰“å¼€[åœ¨çº¿æ¥å£è°ƒè¯•å·¥å…·](https://hoppscotch.io/)ï¼Œè¾“å…¥ Webhook åœ°å€ï¼Œé…ç½®é’‰é’‰[æ¶ˆæ¯ç±»å‹åŠæ•°æ®æ ¼å¼](https://open.dingtalk.com/document/robots/custom-robot-access#title-72m-8ag-pqw)ã€‚

![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/FqEYt6cimbEW4pJDET2YEsevO3bQ.png)

3. è°ƒè¯•åˆ°è‡ªå·±æƒ³è¦çš„æ•ˆæœåå¤åˆ¶è¯·æ±‚çš„ä»£ç ã€‚

![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/FqxbJqsBt0_l1REj_8luZiqzFBxH.png)

---

è¿™ä¸ªå‡½æ•°æ˜¯é€šè¿‡ post è¯·æ±‚è¿›è¡Œè°ƒç”¨ï¼Œé¦–å…ˆéœ€è¦ä»è¯·æ±‚ä½“ä¸­è·å–`slug`å’Œ`title`ã€‚

```javascript
const data = JSON.parse(params.body);
const { slug, title } = data.data;
```

ç„¶åå†è¯·æ±‚é’‰é’‰æœºå™¨äººçš„ Webhook åœ°å€ã€‚

```javascript
const axios = require("axios");

const options = {
  method: "POST",
  url: "https://oapi.dingtalk.com/robot/send",
  params: {
    access_token: "",
  },
  headers: { "content-type": "application/json" },
  data: {
    msgtype: "actionCard",
    actionCard: {
      title: "æ–‡æ¡£å‘å¸ƒ",
      text: `${title}`,
      btnOrientation: "0",
      btns: [
        {
          title: "å‘å¸ƒ",
          actionURL: `https://xx-xx-xx.cn-hangzhou.fcapp.run?slug=${slug}`,
        }, // è§¦å‘GithubActionäº‘å‡½æ•°çš„å…¬ç½‘åœ°å€
        {
          title: "Actions",
          actionURL:
            "https://github.com/songxingguo/songxingguo.github.io/actions",
        },
      ],
    },
  },
};

axios
  .request(options)
  .then(function (response) {
    console.log(response.data);
  })
  .catch(function (error) {
    console.error(error);
  });
```

å…¶ä¸­`access_token `ä¸ºé’‰é’‰ webhook åœ°å€ä¸­çš„æˆæƒç ã€‚

```javascript
https://oapi.dingtalk.com/robot/send?access_token=xx
```

æœ€ç»ˆçš„æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºã€‚
![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/FgwZMGzVe6xjsIMMsYyDrVxql0ku.png)
å®Œæ•´ä»£ç å¦‚ä¸‹ã€‚

```javascript
var getRawBody = require("raw-body");
var getFormBody = require("body/form");
var body = require("body");
var axios = require("axios");

/*
To enable the initializer feature (https://help.aliyun.com/document_detail/156876.html)
please implement the initializer function as belowï¼š
exports.initializer = (context, callback) => {
  console.log('initializing');
  callback(null, '');
};
*/

exports.handler = (req, resp, context) => {
  console.log("hello world");

  var params = {
    path: req.path,
    queries: req.queries,
    headers: req.headers,
    method: req.method,
    requestURI: req.url,
    clientIP: req.clientIP,
  };

  getRawBody(req, async (err, body) => {
    for (var key in req.queries) {
      var value = req.queries[key];
      resp.setHeader(key, value);
    }
    resp.setHeader("Content-Type", "text/plain");
    params.body = body.toString();

    const data = JSON.parse(params.body);
    const { slug, title } = data.data;
    console.log("slug", slug);

    const options = {
      method: "POST",
      url: "https://oapi.dingtalk.com/robot/send",
      params: {
        access_token: "",
      },
      headers: { "content-type": "application/json" },
      data: {
        msgtype: "actionCard",
        actionCard: {
          title: "æ–‡æ¡£å‘å¸ƒ",
          text: `${title}`,
          btnOrientation: "0",
          btns: [
            {
              title: "å‘å¸ƒ",
              actionURL: `https://xx-xx-xx.cn-hangzhou.fcapp.run?slug=${slug}`,
            },
            {
              title: "Actions",
              actionURL:
                "https://github.com/songxingguo/songxingguo.github.io/actions",
            },
          ],
        },
      },
    };

    await axios
      .request(options)
      .then(function (response) {
        console.log(response.data);
      })
      .catch(function (error) {
        console.error(error);
      });

    resp.send(JSON.stringify(params, null, "    "));
  });
};
```

#### é…ç½®è¯­é›€ Webhook

è¿›å…¥è¯­é›€[webhook é…ç½®é¡µé¢](https://www.yuque.com/songxingguo/devhints/settings/webhooks)ï¼Œå¡«å†™åç§°å’Œ**æ¨é€é’‰é’‰æ¶ˆæ¯**äº‘å‡½æ•°çš„å…¬ç½‘åœ°å€ï¼Œå¹¶é€‰æ‹©**æ›´æ–°æ–‡æ¡£**æ—¶è§¦å‘ã€‚
![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/Fmtzly3_0hghg_uvqaK6eDgmsT-M.png)

## å…¶ä»–

### [Hoppscotch](https://hoppscotch.io/)

Hoppscotch å’Œ postman çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†è¿™ä¸ªæ˜¯çº¿ä¸Šçš„ç‰ˆæœ¬ï¼Œæ›´åŠ çš„æ–¹ä¾¿ã€‚æœ‰æ—¶è¯·æ±‚ä¼šå‡ºç°è¯·æ±‚æ— æ³•åˆ°è¾¾çš„é—®é¢˜ï¼Œéœ€è¦é…ç½®æ’ä»¶ä»£ç†ï¼Œå°†è¯·æ±‚çš„åŸŸååŠ å…¥åˆ°æ’ä»¶ä¸­ã€‚
![](https://raw.githubusercontent.com/songxingguo/songxingguo.github.io/hexo/static/images/FkPke4qlMP1Zv2PALiW8f-dAATr5.png)

## [æ‹“å±•é˜…è¯»](https://www.yuque.com/songxingguo/devhints/gwpsg4dq6tp27z3s)

[Github Actions æŒç»­é›†æˆ Docker æ„å»ºå¹¶éƒ¨ç½² Node é¡¹ç›®åˆ°äº‘æœåŠ¡å™¨](https://www.yuque.com/1874w/1874.cool/ovugli?view=doc_embed)

[yueque-hexo å›¾åºŠé…ç½®](https://github.com/LetTTGACO/yuque-hexo-example)

[è¯­é›€äº‘ç«¯å†™ä½œ Hexo+Github Actions+COS æŒç»­é›†æˆ](https://www.yuque.com/1874w/1874.cool/roeayv?view=doc_embed)
[Webhooks](https://www.yuque.com/yuque/developer/doc-webhook?view=doc_embed)
