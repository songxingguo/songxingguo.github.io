<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#34495e">
  <title>knex.js中文文档 | 阿有的博客</title>
  <link rel="alternate" href="path/of/rss" type="application/atom+xml">
  <link rel="shortcut icon" type="image/ico" href="/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
  

  

  

  

</head>

<body>
  <div class="mobile-header">
    <span><i class="iconfont icon-turnon" id="mobile-nav-toggle"></i></span>
    <div class="mobile-logo">
      <a href="/.">SongXingguo‘s blog</a>
    </div>
  </div>
  <div class="page" id="mobile-nav-panel">
    <div class="container">
      <header class="site-nav">
      <div class="nav-content">
        <div class="logo">
          <a href="/">SongXingguo‘s blog</a>
        </div>
        <nav class="navbar">
          <ul>
            
              <li class="menu-item">
                <a href="/" class="menu-item-link"><i class="iconfont icon-home"></i>首页</a>
              </li>
            
              <li class="menu-item">
                <a href="/archives" class="menu-item-link"><i class="iconfont icon-archive"></i>归档</a>
              </li>
            
              <li class="menu-item">
                <a href="/categories" class="menu-item-link"><i class="iconfont icon-category"></i>分类</a>
              </li>
            
              <li class="menu-item">
                <a href="/tags" class="menu-item-link"><i class="iconfont icon-tags"></i>标签</a>
              </li>
            
              <li class="menu-item">
                <a href="/about" class="menu-item-link"><i class="iconfont icon-about"></i>关于</a>
              </li>
            
          </ul>
        </nav>
      </div>
</header>

      <div class="banner">
  <div class="show">
    <!-- <img src="/" alt="banner"> -->
    <div class="banner-title">
      
        <div class="post-title">
          knex.js中文文档
            <div class="post-tags">
    		    
              <a class="tag-link" href="/tags/knexjs/">knexjs</a>
            
    	      </div>
        </div>
      
    </div>
  </div>
</div>

      <main class="main"id="main">
          <article class="post">
  

  <header>
    <div class="post-title mobile-post-title">
      <h1>knex.js中文文档</h1>
        <div class="post-tags">
        
          <a class="tag-link" href="/tags/knexjs/">knexjs</a>
        
        </div>
    </div>
    <div class="post-meta">
      <span class="post-time"><i class="iconfont icon-calendar"></i>2018-06-30</span>
      
          
            <i class="iconfont icon-divide"></i>
            <i class="iconfont icon-folder" style="color: #8a8a8a;"></i>
            <a class="post-category" href="/categories/技术学习/">技术学习</a>
          
            <i class="iconfont icon-divide"></i>
            <i class="iconfont icon-folder" style="color: #8a8a8a;"></i>
            <a class="post-category" href="/categories/技术学习/数据库/">数据库</a>
          
      
      <!----------------------------------->
        
      <!----------------------------------->
    </div>
  </header>
  
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#knexjs-简介"><span class="toc-text">knexjs 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#支持"><span class="toc-text">支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始数据库"><span class="toc-text">初始数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#knex-查询构造器"><span class="toc-text">knex 查询构造器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#声明别名"><span class="toc-text">声明别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#knex"><span class="toc-text">knex</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#timeout"><span class="toc-text">timeout</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#select"><span class="toc-text">select</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#as"><span class="toc-text">as</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#column"><span class="toc-text">column</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#from"><span class="toc-text">from</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#with"><span class="toc-text">with</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#withSchema"><span class="toc-text">withSchema</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Where-语句"><span class="toc-text">Where 语句</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#where"><span class="toc-text">where</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#whereNot"><span class="toc-text">whereNot</span></a></li></ol></li></ol></li></ol>
    </div>
  </div>


  <div class="post-content">
    <h3 id="knexjs-简介"><a href="#knexjs-简介" class="headerlink" title="knexjs 简介"></a>knexjs 简介</h3><p> &emsp;&emsp;Knex.js是为Postgres，MSSQL，MySQL，MariaDB，SQLite3，Oracle和Amazon Redshift设计的“包含电池”SQL查询构建器，其设计灵活，便于携带并且使用起来非常有趣。它具有传统的节点样式回调以及用于清洁异步流控制的承诺接口，流接口，全功能查询和模式构建器，事务支持（带保存点），连接池 以及不同查询客户和方言之间的标准化响应。<a href="https://knexjs.org/#Installation-node" target="_blank" rel="noopener">传送门</a></p>
<h3 id="支持"><a href="#支持" class="headerlink" title="支持"></a>支持</h3><p>&emsp;&emsp;Knex的主要目标环境是Node.js，您需要安装该knex库，然后安装适当的数据库库：pg适用于PostgreSQL和Amazon Redshift，mysql适用于MySQL或MariaDB，sqlite3适用于SQLite3或mssql适用于MSSQL。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ npm install knex --save</span><br><span class="line"></span><br><span class="line"># Then add one of the following (adding a --save) flag:</span><br><span class="line">$ npm install pg</span><br><span class="line">$ npm install sqlite3</span><br><span class="line">$ npm install mysql</span><br><span class="line">$ npm install mysql2</span><br><span class="line">$ npm install mariasql</span><br><span class="line">$ npm install strong-oracle</span><br><span class="line">$ npm install oracle</span><br><span class="line">$ npm install mssql</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="初始数据库"><a href="#初始数据库" class="headerlink" title="初始数据库"></a>初始数据库</h3><p>&emsp;&emsp;该knex模块本身是一个为Knex提供配置对象的函数，它接受一些参数。该client参数是必需的，并确定哪个客户端适配器将与该库一起使用。</p>
<p>mysql数据库初始化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var knex = require(&apos;knex&apos;)(&#123;</span><br><span class="line">  client: &apos;mysql&apos;,</span><br><span class="line">  connection: &#123;</span><br><span class="line">    host : &apos;127.0.0.1&apos;,</span><br><span class="line">    user : &apos;your_database_user&apos;,</span><br><span class="line">    password : &apos;your_database_password&apos;,</span><br><span class="line">    database : &apos;myapp_test&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="knex-查询构造器"><a href="#knex-查询构造器" class="headerlink" title="knex 查询构造器"></a>knex 查询构造器</h3><p>knex 查询构造器是用于构建和执行标准的SQL查询,例如：select, insert, update, delete.</p>
<p>在API的许多地方，表名或列名等标识符都可以传递给方法。</p>
<p>最常见的只需要简单tableName.columnName，tableName或者columnName，但在许多情况下，还需要传递一个别名，以便稍后在查询中引用该标识符。</p>
<ul>
<li><h4 id="声明别名"><a href="#声明别名" class="headerlink" title="声明别名"></a>声明别名</h4><p>有两种方法可以为标识符声明别名。可以直接 <code>as aliasName</code> 为标识符提供前缀，也可以传递对象 <code>{ aliasName: &#39;identifierName&#39; }</code> 。</p>
<p>如果对象具有多个别名 <code>{ alias1: &#39;identifier1&#39;, alias2: &#39;identifier2&#39; }</code> ，则所有别名标识符将扩展为逗号分隔列表。</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   knex(&#123; a: &apos;table&apos;, b: &apos;table&apos; &#125;)</span><br><span class="line">.select(&#123;</span><br><span class="line">  aTitle: &apos;a.title&apos;,</span><br><span class="line">  bTitle: &apos;b.title&apos;</span><br><span class="line">&#125;)</span><br><span class="line">.whereRaw(&apos;?? = ??&apos;, [&apos;a.column_1&apos;, &apos;b.column_2&apos;])</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `a`.`title` as `aTitle`, `b`.`title` as `bTitle` from `table` as `a`, `table` as `b` where `a`.`column_1` = `b`.`column_2`</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="knex"><a href="#knex" class="headerlink" title="knex"></a>knex</h4><p> -knex(tableName, options={only: boolean}) / knex.[methodName]</p>
<p>查询构建器通过指定要查询的表名或通过直接在knex对象上调用任何方法来启动。这将启动类似jQuery的链，您可以根据需要调用其他查询构建器方法来构造查询，最终调用任何接口方法，将其转换为toString或返回一个promise对象，回调或链式执行查询。</p>
<ul>
<li><h5 id="timeout"><a href="#timeout" class="headerlink" title="timeout"></a>timeout</h5><p>-.timeout(ms, options={cancel: boolean})</p>
<p>设置查询的超时时间，并且如果超时超时，将会引发TimeoutError。该错误包含有关查询，绑定和设置的超时的信息。对于想要确保执行的复杂查询不会花太长时间。传递选项的可选第二个参数：cancel：if ，如果达到超时则取消查询。*注意：目前只支持MySQL和MariaDB。 </p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex.select().from(&apos;books&apos;).timeout(1000)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `books`</span><br></pre></td></tr></table></figure>
<hr>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex.select().from(&apos;books&apos;).timeout(1000, &#123;cancel: true&#125;) // MySQL and MariaDB only</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `books`</span><br></pre></td></tr></table></figure>
</li>
<li><h5 id="select"><a href="#select" class="headerlink" title="select"></a>select</h5><p> -.select([*columns])</p>
<p>创建一个select查询，为查询提供可选的列数组，如果在构建查询时没有指定，则最终默认为*。select调用的响应将使用从数据库中选择的对象数组来解析。</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex.select(&apos;title&apos;, &apos;author&apos;, &apos;year&apos;).from(&apos;books&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `title`, `author`, `year` from `books`</span><br></pre></td></tr></table></figure>
<hr>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex.select().table(&apos;books&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `books`</span><br></pre></td></tr></table></figure>
</li>
<li><h5 id="as"><a href="#as" class="headerlink" title="as"></a>as</h5><p>-.as(name)</p>
<p>允许对子查询进行别名，并取出希望命名当前查询的字符串。如果查询不是子查询，它将被忽略。</p>
<p>例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">knex.avg(&apos;sum_column1&apos;).from(function() &#123;</span><br><span class="line">  this.sum(&apos;column1 as sum_column1&apos;).from(&apos;t1&apos;).groupBy(&apos;column1&apos;).as(&apos;t1&apos;)</span><br><span class="line">&#125;).as(&apos;ignored_alias&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select avg(`sum_column1`) from (select sum(`column1`) as `sum_column1` from `t1` group by `column1`) as `t1`</span><br></pre></td></tr></table></figure>
</li>
<li><h5 id="column"><a href="#column" class="headerlink" title="column"></a>column</h5><p>— .column(columns)</p>
<p>专门设置要在选择查询中选择的列，并获取数组，列表或列名称。传递对象将使用给定的键自动对列进行别名。</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex.column(&apos;title&apos;, &apos;author&apos;, &apos;year&apos;).select().from(&apos;books&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `title`, `author`, `year` from `books`</span><br></pre></td></tr></table></figure>
<hr>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex.column([&apos;title&apos;, &apos;author&apos;, &apos;year&apos;]).select().from(&apos;books&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `title`, `author`, `year` from `books`</span><br></pre></td></tr></table></figure>
<hr>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex.column(&apos;title&apos;, &#123;by: &apos;author&apos;&#125;, &apos;year&apos;).select().from(&apos;books&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `title`, `author` as `by`, `year` from `books`</span><br></pre></td></tr></table></figure>
</li>
<li><h5 id="from"><a href="#from" class="headerlink" title="from"></a>from</h5><p>— .from([tableName], options={only: boolean})</p>
<p>指定当前查询中使用的表格，如果已经指定了当前表格名称，则替换当前表格名称。这通常用于高级where或union方法中执行的子查询。传递选项的可选第二个参数：only：if ，在放弃继承表数据之前使用ONLY关键字。*注意：目前只支持PostgreSQL。 truetableName</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex.select(&apos;*&apos;).from(&apos;users&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `users`</span><br></pre></td></tr></table></figure>
</li>
<li><h5 id="with"><a href="#with" class="headerlink" title="with"></a>with</h5><p>— .with(alias, function|raw)</p>
<p>为查询添加“with”子句。“With”子句由PostgreSQL，Oracle，SQLite3和MSSQL支持。</p>
<p>例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex.with(&apos;with_alias&apos;, knex.raw(&apos;select * from &quot;books&quot; where &quot;author&quot; = ?&apos;, &apos;Test&apos;)).select(&apos;*&apos;).from(&apos;with_alias&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">with `with_alias` as (select * from &quot;books&quot; where &quot;author&quot; = &apos;Test&apos;) select * from `with_alias`</span><br></pre></td></tr></table></figure>
<hr>
<p>例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">knex.with(&apos;with_alias&apos;, (qb) =&gt; &#123;</span><br><span class="line">  qb.select(&apos;*&apos;).from(&apos;books&apos;).where(&apos;author&apos;, &apos;Test&apos;)</span><br><span class="line">&#125;).select(&apos;*&apos;).from(&apos;with_alias&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">with `with_alias` as (select * from `books` where `author` = &apos;Test&apos;) select * from `with_alias`</span><br></pre></td></tr></table></figure>
</li>
<li><h5 id="withSchema"><a href="#withSchema" class="headerlink" title="withSchema"></a>withSchema</h5><p>— .withSchema([schemaName])</p>
<p>指定要用作表名前缀的模式。多表查询。</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex.withSchema(&apos;public&apos;).select(&apos;*&apos;).from(&apos;users&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `public`.`users`</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><h4 id="Where-语句"><a href="#Where-语句" class="headerlink" title="Where 语句"></a>Where 语句</h4><p>  有几种方法可以帮助动态地从句。在很多地方，函数可以用来代替值，构造子查询。在大多数地方，现有的knex查询可能用于组成子查询等。请查看每种使用说明方法的几个示例：</p>
<p>  重要提示：undefined为任何where函数提供值的knex将导致knex在SQL编译期间抛出错误。这是为了你和我们的缘故。Knex不知道如何处理where子句中的未定义值，并且通常在提供一个开头时会出现编程错误。该错误将引发包含查询类型和已编译的查询字符串的消息。</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;accounts&apos;)</span><br><span class="line">.where(&apos;login&apos;, undefined)</span><br><span class="line">.select()</span><br><span class="line">.toSQL()</span><br></pre></td></tr></table></figure>
<p>错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Undefined binding(s) detected when compiling SELECT query: select * from `accounts` where `login` = ?</span><br></pre></td></tr></table></figure>
<ul>
<li><h5 id="where"><a href="#where" class="headerlink" title="where"></a>where</h5><p>— .where(~mixed~)</p>
<ul>
<li><p>对象语法</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;users&apos;).where(&#123;</span><br><span class="line">  first_name: &apos;Test&apos;,</span><br><span class="line">  last_name:  &apos;User&apos;</span><br><span class="line">&#125;).select(&apos;id&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `id` from `users` where `first_name` = &apos;Test&apos; and `last_name` = &apos;User&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>键值对</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;users&apos;).where(&apos;id&apos;, 1)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `users` where `id` = 1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>函数</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;users&apos;)</span><br><span class="line">.where((builder) =&gt;</span><br><span class="line">  builder.whereIn(&apos;id&apos;, [1, 11, 15]).whereNotIn(&apos;id&apos;, [17, 19])</span><br><span class="line">)</span><br><span class="line">.andWhere(function() &#123;</span><br><span class="line">  this.where(&apos;id&apos;, &apos;&gt;&apos;, 10)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `users` where (`id` in (1, 11, 15) and `id` not in (17, 19)) and (`id` &gt; 10)</span><br></pre></td></tr></table></figure>
</li>
<li><p>链式调用</p>
<p>例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;users&apos;).where(function() &#123;</span><br><span class="line">  this.where(&apos;id&apos;, 1).orWhere(&apos;id&apos;, &apos;&gt;&apos;, 10)</span><br><span class="line">&#125;).orWhere(&#123;name: &apos;Tester&apos;&#125;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `users` where (`id` = 1 or `id` &gt; 10) or (`name` = &apos;Tester&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>分隔符</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;users&apos;).where(&apos;columnName&apos;, &apos;like&apos;, &apos;%rowlikeme%&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `users` where `columnName` like &apos;%rowlikeme%&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>以上查询演示了返回指定列中出现特定模式的所有用户的常见用例。</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;users&apos;).where(&apos;votes&apos;, &apos;&gt;&apos;, 100)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `users` where `votes` &gt; 100</span><br></pre></td></tr></table></figure>
<hr>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var subquery = knex(&apos;users&apos;).where(&apos;votes&apos;, &apos;&gt;&apos;, 100).andWhere(&apos;status&apos;, &apos;active&apos;).orWhere(&apos;name&apos;, &apos;John&apos;).select(&apos;id&apos;);</span><br><span class="line"></span><br><span class="line">knex(&apos;accounts&apos;).where(&apos;id&apos;, &apos;in&apos;, subquery)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `accounts` where `id` in (select `id` from `users` where `votes` &gt; 100 and `status` = &apos;active&apos; or `name` = &apos;John&apos;)</span><br></pre></td></tr></table></figure>
<p>或者与对象一起自动包装声明并创建一个or (and - and - and)子句</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;users&apos;).where(&apos;id&apos;, 1).orWhere(&#123;votes: 100, user: &apos;knex&apos;&#125;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `users` where `id` = 1 or (`votes` = 100 and `user` = &apos;knex&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><h5 id="whereNot"><a href="#whereNot" class="headerlink" title="whereNot"></a>whereNot</h5><p>— .whereNot(~mixed~)</p>
<ul>
<li><p>对象</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;users&apos;).whereNot(&#123;</span><br><span class="line">  first_name: &apos;Test&apos;,</span><br><span class="line">  last_name:  &apos;User&apos;</span><br><span class="line">&#125;).select(&apos;id&apos;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `id` from `users` where not `first_name` = &apos;Test&apos; and not `last_name` = &apos;User&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>键值对</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;users&apos;).whereNot(&apos;id&apos;, 1)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `users` where not `id` = 1</span><br></pre></td></tr></table></figure>
</li>
<li><p>链式调用</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;users&apos;).whereNot(function() &#123;</span><br><span class="line">  this.where(&apos;id&apos;, 1).orWhereNot(&apos;id&apos;, &apos;&gt;&apos;, 10)</span><br><span class="line">&#125;).orWhereNot(&#123;name: &apos;Tester&apos;&#125;)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `users` where not (`id` = 1 or not `id` &gt; 10) or not `name` = &apos;Tester&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>分隔符</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knex(&apos;users&apos;).whereNot(&apos;votes&apos;, &apos;&gt;&apos;, 100)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `users` where not `votes` &gt; 100</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>CAVEAT：WhereNot不适用于“in”和“between”类型的子查询。您应该使用“not in”和“not betwee”之间。</p>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var subquery = knex(&apos;users&apos;)</span><br><span class="line">  .whereNot(&apos;votes&apos;, &apos;&gt;&apos;, 100)</span><br><span class="line">  .andWhere(&apos;status&apos;, &apos;active&apos;)</span><br><span class="line">  .orWhere(&apos;name&apos;, &apos;John&apos;)</span><br><span class="line">  .select(&apos;id&apos;);</span><br><span class="line"></span><br><span class="line">knex(&apos;accounts&apos;).where(&apos;id&apos;, &apos;not in&apos;, subquery)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `accounts` where `id` not in (select `id` from `users` where not `votes` &gt; 100 and `status` = &apos;active&apos; or `name` = &apos;John&apos;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>

  </div>
  <div class="post-footer">the end</div>
</article>

          
  <nav class="pagination post-nav">
    
    
      <a href="/2018/06/29/refresh-boot/">
        <span class="next-post">小米MIX 2线刷步骤<i class="iconfont icon-more"></i></span>
      </a>
    
  </nav>


          
  


      </main>
    </div>
    <footer>
      <div class="social-links">
        
          
            <a href="https://github.com/songxingguo"><i class="iconfont icon-github"></i></a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
      
        <div class="quote">
          <p>专注，极致，快</p>
        </div>
      
      <div class="copyright">
        <p>
          由 <a href="https://hexo.io/">Hexo</a> 强力驱动
          <span>|</span>
          主题 - <a href="https://github.com/wa-ri/hexo-theme-ztopic">ztopic</a>
          <span>|</span>
          Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>
        </p>
        <p>
          <span>
          
          &copy;
          
            2018
          
          </span>
          <i class="iconfont icon-circle"></i>
          <span>songxingguo</span>
        </p>
      </div>
</footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <div id="mobile-nav">
  <nav id="mobile-nav-menu">
    
      <a href="/" class="mobile-nav-link"><i class="iconfont icon-home"></i>首页</a>
    
      <a href="/archives" class="mobile-nav-link"><i class="iconfont icon-archive"></i>归档</a>
    
      <a href="/categories" class="mobile-nav-link"><i class="iconfont icon-category"></i>分类</a>
    
      <a href="/tags" class="mobile-nav-link"><i class="iconfont icon-tags"></i>标签</a>
    
      <a href="/about" class="mobile-nav-link"><i class="iconfont icon-about"></i>关于</a>
    
    <div class="mobile-intro"><i class="iconfont icon-pen"></i>写文章，做分享</div>
  </nav>
</div>


  <script src="/libs/jQuery/jquery-3.2.1.min.js"></script>
  <script src="/libs/slideout/slideout.min.js"></script>
  
    <link rel="stylesheet" href="/libs/fancybox/jquery.fancybox.css">
    <script src="/libs/fancybox/jquery.fancybox.pack.js"></script>
  
  

  <script src="/js/ztopic.js"></script>
</body>
</html>
